<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Clustering</title>
    <link href="clustering.css" rel="stylesheet" type="text/css">
    <script language="javascript" type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
    <script language="javascript" type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.min.js"></script>
    <script language="javascript" type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.resize.min.js"></script>
    <script type="text/javascript">

    $(document).ready(function() {
        $(function() {
            // http://stackoverflow.com/questions/979975/how-to-get-the-value-from-url-parameter/979996#979996
            var params = {}; 
            if (location.search) {
                var parts = location.search.substring(1).split('&');
                        
                for (var i = 0; i < parts.length; i++) {
                    var nv = parts[i].split('=');
                    if (!nv[0]) continue;
                    params[nv[0]] = decodeURIComponent(nv[1]) || true;
                }       
            }

            var filename = 'dataset_01.txt';
            if (params.filename) {
                filename = params.filename;
            }
            var prefix = '/json/cluster/';
            var url = prefix + filename;

            var data = [];
            var options = {
                series: {
                    lines: { show: false },
                    points: { show: true, fill: true, fillColor: false },
                    shadowSize: 0
                }
            };

            $.getJSON(url, function(json) {
                data = json['clusters'];
                console.log(data);
                if (!data || data == {}) {
                    document.getElementById("title").innerHTML = "No data yet; try again in a few seconds";
                    setTimeout(function() {
                        document.getElementById("title").innerHTML = "Ok, fine, I'll reload for you";
                        document.location.reload(true);
                    }, 10000);
                    return;
                }
                $.plot("#placeholder", data[0], options);
                document.getElementById("title").innerHTML = filename;
            })
            .fail(function() {
                document.getElementById("title").innerHTML = "No data available for given filename";
            });
        });
    });

    </script>
</head>
<body>

    <div id="header">
        <h1 id="title">Retrieving Data</h1>
    </div>

    <div id="placeholder"></div>

</body>
</html>
